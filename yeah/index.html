<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeah Network - Job Board</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/yeah/manifest.json">
    
    <!-- jQuery and jQuery Mobile -->
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .ui-header {
            background-color: var(--secondary-color) !important;
            color: white !important;
            border: none !important;
        }
        
        .ui-footer {
            background-color: var(--secondary-color) !important;
            color: white !important;
            border: none !important;
            padding: 0 !important;
        }
        
        .logo {
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color) !important;
            border-color: var(--secondary-color) !important;
        }
        
        .btn-success {
            background-color: #27ae60 !important;
            border-color: #27ae60 !important;
        }
        
        .job-card {
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            background-color: white;
            cursor: pointer;
        }
        
        .job-title {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }
        
        .job-org {
            color: var(--primary-color);
            font-size: 0.9em;
        }
        
        .job-meta {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .job-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .status-pending {
            background-color: #f39c12;
            color: white;
        }
        
        .status-approved {
            background-color: #27ae60;
            color: white;
        }
        
        .status-rejected {
            background-color: #e74c3c;
            color: white;
        }
        
        .admin-panel {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .admin-section {
            margin-bottom: 20px;
        }
        
        .admin-section h3 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .rich-text-editor {
            min-height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
        }
        
        .action-buttons {
            margin-top: 10px;
        }
        
        .action-buttons button {
            margin-right: 5px;
        }
        
        .search-form {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .browse-section {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .category-list, .location-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .category-item, .location-item {
            background-color: var(--light-color);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .category-item:hover, .location-item:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .job-detail {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .job-detail h2 {
            color: var(--secondary-color);
            margin-top: 0;
        }
        
        .job-detail-meta {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .job-detail-section {
            margin-bottom: 20px;
        }
        
        .job-detail-section h3 {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .share-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .share-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 0.9em;
        }
        
        .share-facebook {
            background-color: #3b5998;
        }
        
        .share-twitter {
            background-color: #1da1f2;
        }
        
        .share-linkedin {
            background-color: #0077b5;
        }
        
        .share-whatsapp {
            background-color: #25d366;
        }
        
        .apply-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #27ae60;
            color: white;
            text-align: center;
            border-radius: 5px;
            font-weight: bold;
            margin: 20px 0;
            text-decoration: none;
        }
        
        .offline-page {
            text-align: center;
            padding: 40px 20px;
        }
        
        .offline-icon {
            font-size: 64px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        /* Fixed Navigation */
        .fixed-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--secondary-color);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #95a5a6;
            text-decoration: none;
            font-size: 0.8em;
            flex: 1;
        }
        
        .nav-item i {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .nav-item.active {
            color: white;
        }
        
        .ui-content {
            padding-bottom: 70px !important;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .ui-grid-a .ui-block-a,
            .ui-grid-a .ui-block-b {
                width: 50%;
            }
        }
    </style>
</head>
<body>
    <!-- Home Page -->
    <div data-role="page" id="home">
        <div data-role="header" data-position="fixed">
            <a href="#" data-rel="back" data-icon="arrow-l" data-iconpos="notext">Back</a>
            <h1><a href="#home" class="logo">Yeah Network</a></h1>
            <a href="#login" class="ui-btn-right" id="login-btn">Login</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="search-form">
                <h3>Find Your Dream Job</h3>
                <form id="search-form">
                    <div class="form-group">
                        <label for="search-title">Job Title</label>
                        <input type="text" id="search-title" class="form-control" placeholder="Enter job title">
                    </div>
                    <div class="form-group">
                        <label for="search-category">Category</label>
                        <select id="search-category" class="form-control">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="search-location">Location</label>
                        <select id="search-location" class="form-control">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Search Jobs</button>
                </form>
            </div>
            
            <div class="browse-section">
                <h3>Browse by Category</h3>
                <div class="category-list" id="category-list">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="browse-section">
                <h3>Browse by Location</h3>
                <div class="location-list" id="location-list">
                    <!-- Locations will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="job-listings">
                <h3>Latest Job Postings</h3>
                <!-- Job listings will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Login Page -->
    <div data-role="page" id="login">
        <div data-role="header" data-position="fixed">
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
            <h1>Login</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>Sign In</h3>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Login</button>
                </form>
                <p>Don't have an account? <a href="#signup" data-transition="slide">Sign up here</a></p>
            </div>
        </div>
    </div>
    
    <!-- Signup Page -->
    <div data-role="page" id="signup">
        <div data-role="header" data-position="fixed">
            <a href="#login" data-icon="arrow-l" data-iconpos="notext">Back</a>
            <h1>Sign Up</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>Create Account</h3>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-organization">Organization</label>
                        <input type="text" id="signup-organization" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Create Account</button>
                </form>
                <p>Already have an account? <a href="#login" data-transition="slide">Login here</a></p>
            </div>
        </div>
    </div>
    
    <!-- Job Board Page -->
    <div data-role="page" id="job-board">
        <div data-role="header" data-position="fixed">
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
            <h1>Job Board</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div id="job-board-listings">
                <!-- Job listings will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Job Detail Page -->
    <div data-role="page" id="job-detail">
        <div data-role="header" data-position="fixed">
            <a href="#job-board" data-icon="arrow-l" data-iconpos="notext">Back</a>
            <h1>Job Details</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div id="job-detail-content">
                <!-- Job details will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Post Job Page -->
    <div data-role="page" id="post-job">
        <div data-role="header" data-position="fixed">
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
            <h1>Post a Job</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <form id="job-form">
                    <div class="form-group">
                        <label for="job-title">Job Title</label>
                        <input type="text" id="job-title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-organization">Organization</label>
                        <input type="text" id="job-organization" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-category">Category</label>
                        <select id="job-category" class="form-control" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-location">Location</label>
                        <select id="job-location" class="form-control" required>
                            <option value="">Select Location</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-description">Job Description</label>
                        <div class="rich-text-editor" id="job-description" contenteditable="true"></div>
                    </div>
                    <div class="form-group">
                        <label for="job-requirements">Job Requirements</label>
                        <div class="rich-text-editor" id="job-requirements" contenteditable="true"></div>
                    </div>
                    <div class="form-group">
                        <label for="job-apply-link">Application Link</label>
                        <input type="url" id="job-apply-link" class="form-control" placeholder="https://..." required>
                    </div>
                    <div class="form-group">
                        <label for="job-deadline">Submission Deadline</label>
                        <input type="date" id="job-deadline" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Submit Job</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Profile Page -->
    <div data-role="page" id="profile">
        <div data-role="header" data-position="fixed">
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
            <h1>Profile</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>Account Information</h3>
                <form id="profile-form">
                    <div class="form-group">
                        <label for="profile-name">Full Name</label>
                        <input type="text" id="profile-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-email">Email</label>
                        <input type="email" id="profile-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-organization">Organization</label>
                        <input type="text" id="profile-organization" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-password">New Password (leave blank to keep current)</label>
                        <input type="password" id="profile-password" class="form-control">
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Update Profile</button>
                </form>
                <div class="action-buttons">
                    <button id="logout-btn" class="ui-btn btn-secondary">Logout</button>
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>My Job Postings</h3>
                <div id="my-jobs">
                    <!-- User's job postings will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div data-role="page" id="admin">
        <div data-role="header" data-position="fixed">
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
            <h1>Admin Dashboard</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>User Management</h3>
                <div id="user-management">
                    <!-- User list will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>Category Management</h3>
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-name">Category Name</label>
                        <input type="text" id="category-name" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Add Category</button>
                </form>
                <div id="category-list-admin">
                    <!-- Category list will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>Location Management</h3>
                <form id="location-form">
                    <div class="form-group">
                        <label for="location-name">Location Name</label>
                        <input type="text" id="location-name" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Add Location</button>
                </form>
                <div id="location-list-admin">
                    <!-- Location list will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>Job Listing Management</h3>
                <div id="pending-jobs">
                    <h4>Pending Approval</h4>
                    <!-- Pending jobs will be populated by JavaScript -->
                </div>
                <div id="approved-jobs">
                    <h4>Approved Jobs</h4>
                    <!-- Approved jobs will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Offline Page -->
    <div data-role="page" id="offline">
        <div data-role="header" data-position="fixed">
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
            <h1>Yeah Network</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="offline-page">
                <div class="offline-icon">
                    <i class="fas fa-wifi"></i>
                </div>
                <h2>You're Offline</h2>
                <p>Please check your internet connection and try again to view the latest job postings.</p>
                <p>Some features may be limited while offline.</p>
                <button id="retry-connection" class="ui-btn btn-primary">Retry Connection</button>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Navigation -->
    <div class="fixed-nav">
        <a href="#home" class="nav-item active" id="nav-home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#job-board" class="nav-item" id="nav-jobs">
            <i class="fas fa-briefcase"></i>
            <span>Jobs</span>
        </a>
        <a href="#post-job" class="nav-item hidden" id="nav-post">
            <i class="fas fa-plus"></i>
            <span>Post Job</span>
        </a>
        <a href="#profile" class="nav-item hidden" id="nav-profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <a href="#admin" class="nav-item hidden" id="nav-admin">
            <i class="fas fa-cog"></i>
            <span>Admin</span>
        </a>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
        
        // Online/Offline detection
        window.addEventListener('online', function() {
            // Hide offline page if it's currently active
            if ($.mobile.activePage && $.mobile.activePage.attr('id') === 'offline') {
                $.mobile.changePage('#home');
            }
        });
        
        window.addEventListener('offline', function() {
            $.mobile.changePage('#offline');
        });
    </script>

    <!-- App Logic -->
    <script>
        // App data storage with localStorage
        const DataStore = {
            // Initialize data
            init: function() {
                if (!localStorage.getItem('users')) {
                    const defaultUsers = [
                        {
                            id: 1,
                            name: 'Admin User',
                            email: 'admin@yeahnetwork.com',
                            password: 'admin123',
                            organization: 'Yeah Network',
                            isAdmin: true
                        }
                    ];
                    localStorage.setItem('users', JSON.stringify(defaultUsers));
                }
                if (!localStorage.getItem('jobs')) {
                    localStorage.setItem('jobs', JSON.stringify([]));
                }
                if (!localStorage.getItem('categories')) {
                    const defaultCategories = [
                        { id: 1, name: 'IT' },
                        { id: 2, name: 'Marketing' },
                        { id: 3, name: 'Finance' },
                        { id: 4, name: 'HR' },
                        { id: 5, name: 'Sales' }
                    ];
                    localStorage.setItem('categories', JSON.stringify(defaultCategories));
                }
                if (!localStorage.getItem('locations')) {
                    const defaultLocations = [
                        { id: 1, name: 'New York' },
                        { id: 2, name: 'Remote' },
                        { id: 3, name: 'London' },
                        { id: 4, name: 'San Francisco' },
                        { id: 5, name: 'Tokyo' }
                    ];
                    localStorage.setItem('locations', JSON.stringify(defaultLocations));
                }
                if (!localStorage.getItem('currentUser')) {
                    localStorage.setItem('currentUser', JSON.stringify(null));
                }
            },
            
            // Get data
            getUsers: function() {
                return JSON.parse(localStorage.getItem('users'));
            },
            
            getJobs: function() {
                return JSON.parse(localStorage.getItem('jobs'));
            },
            
            getCategories: function() {
                return JSON.parse(localStorage.getItem('categories'));
            },
            
            getLocations: function() {
                return JSON.parse(localStorage.getItem('locations'));
            },
            
            getCurrentUser: function() {
                return JSON.parse(localStorage.getItem('currentUser'));
            },
            
            // Set data
            setUsers: function(users) {
                localStorage.setItem('users', JSON.stringify(users));
            },
            
            setJobs: function(jobs) {
                localStorage.setItem('jobs', JSON.stringify(jobs));
            },
            
            setCategories: function(categories) {
                localStorage.setItem('categories', JSON.stringify(categories));
            },
            
            setLocations: function(locations) {
                localStorage.setItem('locations', JSON.stringify(locations));
            },
            
            setCurrentUser: function(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            },
            
            // Add data
            addUser: function(user) {
                const users = this.getUsers();
                user.id = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                user.isAdmin = false; // All new users are regular users
                users.push(user);
                this.setUsers(users);
                return user;
            },
            
            addJob: function(job) {
                const jobs = this.getJobs();
                job.id = jobs.length > 0 ? Math.max(...jobs.map(j => j.id)) + 1 : 1;
                job.datePosted = new Date().toISOString().split('T')[0];
                job.status = 'pending'; // New jobs require admin approval
                job.isPublished = false;
                jobs.push(job);
                this.setJobs(jobs);
                return job;
            },
            
            addCategory: function(category) {
                const categories = this.getCategories();
                category.id = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
                categories.push(category);
                this.setCategories(categories);
                return category;
            },
            
            addLocation: function(location) {
                const locations = this.getLocations();
                location.id = locations.length > 0 ? Math.max(...locations.map(l => l.id)) + 1 : 1;
                locations.push(location);
                this.setLocations(locations);
                return location;
            },
            
            // Update data
            updateUser: function(user) {
                const users = this.getUsers();
                const index = users.findIndex(u => u.id === user.id);
                if (index !== -1) {
                    users[index] = user;
                    this.setUsers(users);
                    
                    // Update current user if it's the same user
                    const currentUser = this.getCurrentUser();
                    if (currentUser && currentUser.id === user.id) {
                        this.setCurrentUser(user);
                    }
                    return true;
                }
                return false;
            },
            
            updateJob: function(job) {
                const jobs = this.getJobs();
                const index = jobs.findIndex(j => j.id === job.id);
                if (index !== -1) {
                    jobs[index] = job;
                    this.setJobs(jobs);
                    return true;
                }
                return false;
            },
            
            // Delete data
            deleteUser: function(id) {
                const users = this.getUsers().filter(u => u.id !== id);
                this.setUsers(users);
                return users;
            },
            
            deleteJob: function(id) {
                const jobs = this.getJobs().filter(j => j.id !== id);
                this.setJobs(jobs);
                return jobs;
            },
            
            deleteCategory: function(id) {
                const categories = this.getCategories().filter(c => c.id !== id);
                this.setCategories(categories);
                return categories;
            },
            
            deleteLocation: function(id) {
                const locations = this.getLocations().filter(l => l.id !== id);
                this.setLocations(locations);
                return locations;
            }
        };

        // App logic
        $(document).ready(function() {
            // Initialize data
            DataStore.init();
            
            // Check if user is logged in
            checkAuthStatus();
            
            // Populate dropdowns and lists
            populateCategories();
            populateLocations();
            loadJobListings();
            
            // Setup navigation
            setupNavigation();
            
            // Event handlers
            $('#login-form').on('submit', handleLogin);
            $('#signup-form').on('submit', handleSignup);
            $('#search-form').on('submit', handleSearch);
            $('#job-form').on('submit', handleJobPost);
            $('#profile-form').on('submit', handleProfileUpdate);
            $('#logout-btn').on('click', handleLogout);
            $('#category-form').on('submit', handleAddCategory);
            $('#location-form').on('submit', handleAddLocation);
            $('#retry-connection').on('click', function() {
                if (navigator.onLine) {
                    $.mobile.changePage('#home');
                }
            });
            
            // Navigation events
            $('body').on('click', '.job-card', function() {
                const jobId = $(this).data('id');
                showJobDetail(jobId);
            });
            
            $('body').on('click', '.category-item', function() {
                const categoryId = $(this).data('id');
                filterByCategory(categoryId);
            });
            
            $('body').on('click', '.location-item', function() {
                const locationId = $(this).data('id');
                filterByLocation(locationId);
            });
            
            // Admin event handlers
            $('body').on('click', '.delete-user', function() {
                const userId = $(this).data('id');
                deleteUser(userId);
            });
            
            $('body').on('click', '.delete-category', function() {
                const categoryId = $(this).data('id');
                deleteCategory(categoryId);
            });
            
            $('body').on('click', '.delete-location', function() {
                const locationId = $(this).data('id');
                deleteLocation(locationId);
            });
            
            $('body').on('click', '.delete-job-admin', function() {
                const jobId = $(this).data('id');
                deleteJob(jobId);
            });
            
            $('body').on('click', '.approve-job', function() {
                const jobId = $(this).data('id');
                updateJobStatus(jobId, 'approved');
            });
            
            $('body').on('click', '.reject-job', function() {
                const jobId = $(this).data('id');
                updateJobStatus(jobId, 'rejected');
            });
            
            $('body').on('click', '.toggle-admin', function() {
                const userId = $(this).data('id');
                toggleAdminStatus(userId);
            });
            
            // Page events for navigation highlighting
            $(document).on('pagebeforeshow', function(event, ui) {
                const pageId = ui.toPage.attr('id');
                updateNavigation(pageId);
                
                // Load data for specific pages
                if (pageId === 'admin') {
                    const currentUser = DataStore.getCurrentUser();
                    if (!currentUser || !currentUser.isAdmin) {
                        alert('Access denied. Admin privileges required.');
                        $.mobile.changePage('#home');
                        return;
                    }
                    loadUserManagement();
                    loadJobManagement();
                } else if (pageId === 'profile') {
                    const currentUser = DataStore.getCurrentUser();
                    if (!currentUser) {
                        $.mobile.changePage('#login');
                        return;
                    }
                    loadUserJobs();
                }
            });
            
            // Functions
            function setupNavigation() {
                updateNavigation('home');
            }
            
            function updateNavigation(activePage) {
                // Reset all nav items
                $('.nav-item').removeClass('active');
                
                // Set active based on current page
                switch(activePage) {
                    case 'home':
                        $('#nav-home').addClass('active');
                        break;
                    case 'job-board':
                        $('#nav-jobs').addClass('active');
                        break;
                    case 'post-job':
                        $('#nav-post').addClass('active');
                        break;
                    case 'profile':
                        $('#nav-profile').addClass('active');
                        break;
                    case 'admin':
                        $('#nav-admin').addClass('active');
                        break;
                }
            }
            
            function checkAuthStatus() {
                const currentUser = DataStore.getCurrentUser();
                if (currentUser) {
                    $('#login-btn').text('Logout').attr('href', '#').off('click').on('click', handleLogout);
                    $('#post-job-btn, #profile-btn').removeClass('hidden');
                    $('#nav-post, #nav-profile').removeClass('hidden');
                    
                    // Only show admin button if user is admin
                    if (currentUser.isAdmin) {
                        $('#admin-btn').removeClass('hidden');
                        $('#nav-admin').removeClass('hidden');
                    } else {
                        $('#admin-btn').addClass('hidden');
                        $('#nav-admin').addClass('hidden');
                    }
                } else {
                    $('#login-btn').text('Login').attr('href', '#login');
                    $('#post-job-btn, #profile-btn, #admin-btn').addClass('hidden');
                    $('#nav-post, #nav-profile, #nav-admin').addClass('hidden');
                }
            }
            
            function populateCategories() {
                const categories = DataStore.getCategories();
                const categoryDropdowns = $('#search-category, #job-category');
                
                categoryDropdowns.empty();
                categoryDropdowns.append('<option value="">All Categories</option>');
                
                categories.forEach(category => {
                    categoryDropdowns.append(`<option value="${category.id}">${category.name}</option>`);
                });
                
                // Populate category list for browsing
                const categoryList = $('#category-list');
                categoryList.empty();
                
                categories.forEach(category => {
                    categoryList.append(`<div class="category-item" data-id="${category.id}">${category.name}</div>`);
                });
                
                // Populate admin category list
                const adminCategoryList = $('#category-list-admin');
                if (adminCategoryList.length) {
                    adminCategoryList.empty();
                    
                    categories.forEach(category => {
                        adminCategoryList.append(`
                            <div class="ui-grid-a">
                                <div class="ui-block-a">${category.name}</div>
                                <div class="ui-block-b">
                                    <button class="ui-btn ui-mini delete-category" data-id="${category.id}">Delete</button>
                                </div>
                            </div>
                        `);
                    });
                }
            }
            
            function populateLocations() {
                const locations = DataStore.getLocations();
                const locationDropdowns = $('#search-location, #job-location');
                
                locationDropdowns.empty();
                locationDropdowns.append('<option value="">All Locations</option>');
                
                locations.forEach(location => {
                    locationDropdowns.append(`<option value="${location.id}">${location.name}</option>`);
                });
                
                // Populate location list for browsing
                const locationList = $('#location-list');
                locationList.empty();
                
                locations.forEach(location => {
                    locationList.append(`<div class="location-item" data-id="${location.id}">${location.name}</div>`);
                });
                
                // Populate admin location list
                const adminLocationList = $('#location-list-admin');
                if (adminLocationList.length) {
                    adminLocationList.empty();
                    
                    locations.forEach(location => {
                        adminLocationList.append(`
                            <div class="ui-grid-a">
                                <div class="ui-block-a">${location.name}</div>
                                <div class="ui-block-b">
                                    <button class="ui-btn ui-mini delete-location" data-id="${location.id}">Delete</button>
                                </div>
                            </div>
                        `);
                    });
                }
            }
            
            function loadJobListings(jobs = null) {
                let jobListings = jobs || DataStore.getJobs();
                
                // Filter: Only show approved jobs that are not expired
                const today = new Date().toISOString().split('T')[0];
                jobListings = jobListings.filter(job => 
                    job.status === 'approved' && 
                    job.deadline >= today
                );
                
                const jobListingsContainer = $('#job-listings');
                const jobBoardContainer = $('#job-board-listings');
                
                // Clear existing listings
                jobListingsContainer.find('.job-card').remove();
                if (jobBoardContainer.length) {
                    jobBoardContainer.empty();
                }
                
                if (jobListings.length === 0) {
                    jobListingsContainer.append('<p>No job listings found.</p>');
                    if (jobBoardContainer.length) {
                        jobBoardContainer.append('<p>No job listings found.</p>');
                    }
                    return;
                }
                
                jobListings.forEach(job => {
                    const category = DataStore.getCategories().find(c => c.id === job.categoryId);
                    const location = DataStore.getLocations().find(l => l.id === job.locationId);
                    
                    const jobCard = `
                        <div class="job-card" data-id="${job.id}">
                            <div class="job-title">${job.title}</div>
                            <div class="job-org">${job.organization}</div>
                            <div class="job-meta">${category ? category.name : 'N/A'} | ${location ? location.name : 'N/A'} | Posted: ${job.datePosted}</div>
                            <div class="job-description">${job.description ? job.description.substring(0, 150) + '...' : 'No description available'}</div>
                        </div>
                    `;
                    
                    jobListingsContainer.append(jobCard);
                    if (jobBoardContainer.length) {
                        jobBoardContainer.append(jobCard);
                    }
                });
            }
            
            function handleLogin(e) {
                e.preventDefault();
                
                const email = $('#login-email').val();
                const password = $('#login-password').val();
                
                const users = DataStore.getUsers();
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    DataStore.setCurrentUser(user);
                    checkAuthStatus();
                    $('#login-email, #login-password').val('');
                    $.mobile.changePage('#home');
                    alert('Login successful!');
                } else {
                    alert('Invalid email or password.');
                }
            }
            
            function handleSignup(e) {
                e.preventDefault();
                
                const name = $('#signup-name').val();
                const email = $('#signup-email').val();
                const password = $('#signup-password').val();
                const organization = $('#signup-organization').val();
                
                const users = DataStore.getUsers();
                
                // Check if email already exists
                if (users.find(u => u.email === email)) {
                    alert('Email already registered. Please use a different email.');
                    return;
                }
                
                const newUser = DataStore.addUser({
                    name,
                    email,
                    password,
                    organization
                });
                
                DataStore.setCurrentUser(newUser);
                checkAuthStatus();
                
                $('#signup-name, #signup-email, #signup-password, #signup-organization').val('');
                $.mobile.changePage('#home');
                alert('Account created successfully!');
            }
            
            function handleSearch(e) {
                e.preventDefault();
                
                const title = $('#search-title').val().toLowerCase();
                const categoryId = $('#search-category').val();
                const locationId = $('#search-location').val();
                
                let jobs = DataStore.getJobs();
                
                // Filter: Only show approved jobs that are not expired
                const today = new Date().toISOString().split('T')[0];
                jobs = jobs.filter(job => 
                    job.status === 'approved' && 
                    job.deadline >= today
                );
                
                // Filter jobs based on search criteria
                if (title) {
                    jobs = jobs.filter(job => job.title.toLowerCase().includes(title));
                }
                
                if (categoryId) {
                    jobs = jobs.filter(job => job.categoryId == categoryId);
                }
                
                if (locationId) {
                    jobs = jobs.filter(job => job.locationId == locationId);
                }
                
                loadJobListings(jobs);
                $.mobile.changePage('#job-board');
            }
            
            function handleJobPost(e) {
                e.preventDefault();
                
                const currentUser = DataStore.getCurrentUser();
                if (!currentUser) {
                    alert('You must be logged in to post a job.');
                    return;
                }
                
                const title = $('#job-title').val();
                const organization = $('#job-organization').val();
                const categoryId = $('#job-category').val();
                const locationId = $('#job-location').val();
                const description = $('#job-description').html();
                const requirements = $('#job-requirements').html();
                const applyLink = $('#job-apply-link').val();
                const deadline = $('#job-deadline').val();
                
                const newJob = {
                    title,
                    organization,
                    categoryId: parseInt(categoryId),
                    locationId: parseInt(locationId),
                    description,
                    requirements,
                    applyLink,
                    deadline,
                    userId: currentUser.id
                };
                
                DataStore.addJob(newJob);
                
                // Reset form
                $('#job-form')[0].reset();
                $('#job-description, #job-requirements').html('');
                
                alert('Job submitted for admin approval!');
                $.mobile.changePage('#home');
            }
            
            function handleProfileUpdate(e) {
                e.preventDefault();
                
                const currentUser = DataStore.getCurrentUser();
                if (!currentUser) {
                    alert('You must be logged in to update your profile.');
                    return;
                }
                
                const name = $('#profile-name').val();
                const email = $('#profile-email').val();
                const organization = $('#profile-organization').val();
                const password = $('#profile-password').val();
                
                // Update user
                currentUser.name = name;
                currentUser.email = email;
                currentUser.organization = organization;
                
                if (password) {
                    currentUser.password = password;
                }
                
                DataStore.updateUser(currentUser);
                
                alert('Profile updated successfully!');
            }
            
            function handleLogout() {
                DataStore.setCurrentUser(null);
                checkAuthStatus();
                $.mobile.changePage('#home');
                alert('Logged out successfully!');
            }
            
            function showJobDetail(jobId) {
                const job = DataStore.getJobs().find(j => j.id == jobId);
                if (!job) {
                    alert('Job not found.');
                    return;
                }
                
                const category = DataStore.getCategories().find(c => c.id === job.categoryId);
                const location = DataStore.getLocations().find(l => l.id === job.locationId);
                
                const jobDetailContent = `
                    <div class="job-detail">
                        <h2>${job.title}</h2>
                        <div class="job-detail-meta">
                            ${job.organization} | ${category ? category.name : 'N/A'} | ${location ? location.name : 'N/A'}
                        </div>
                        <div class="job-detail-meta">
                            Posted: ${job.datePosted} | Deadline: ${job.deadline}
                        </div>
                        
                        <div class="share-buttons">
                            <div class="share-btn share-facebook" onclick="shareJob('facebook', ${job.id})">
                                <i class="fab fa-facebook-f"></i> Facebook
                            </div>
                            <div class="share-btn share-twitter" onclick="shareJob('twitter', ${job.id})">
                                <i class="fab fa-twitter"></i> Twitter
                            </div>
                            <div class="share-btn share-linkedin" onclick="shareJob('linkedin', ${job.id})">
                                <i class="fab fa-linkedin-in"></i> LinkedIn
                            </div>
                            <div class="share-btn share-whatsapp" onclick="shareJob('whatsapp', ${job.id})">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </div>
                        </div>
                        
                        ${job.applyLink ? `<a href="${job.applyLink}" target="_blank" class="apply-btn">Apply Now</a>` : ''}
                        
                        <div class="job-detail-section">
                            <h3>Job Description</h3>
                            <div>${job.description || 'No description available'}</div>
                        </div>
                        
                        <div class="job-detail-section">
                            <h3>Job Requirements</h3>
                            <div>${job.requirements || 'No requirements specified'}</div>
                        </div>
                    </div>
                `;
                
                $('#job-detail-content').html(jobDetailContent);
                $.mobile.changePage('#job-detail');
            }
            
            // Share job function
            window.shareJob = function(platform, jobId) {
                const job = DataStore.getJobs().find(j => j.id == jobId);
                if (!job) return;
                
                const jobTitle = encodeURIComponent(job.title);
                const jobOrg = encodeURIComponent(job.organization);
                const shareUrl = encodeURIComponent(window.location.href.split('#')[0] + `#job-detail`);
                const text = encodeURIComponent(`Check out this job: ${job.title} at ${job.organization}`);
                
                let shareLink = '';
                
                switch(platform) {
                    case 'facebook':
                        shareLink = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
                        break;
                    case 'twitter':
                        shareLink = `https://twitter.com/intent/tweet?text=${text}&url=${shareUrl}`;
                        break;
                    case 'linkedin':
                        shareLink = `https://www.linkedin.com/sharing/share-offsite/?url=${shareUrl}`;
                        break;
                    case 'whatsapp':
                        shareLink = `https://api.whatsapp.com/send?text=${text} ${shareUrl}`;
                        break;
                }
                
                if (shareLink) {
                    window.open(shareLink, '_blank', 'width=600,height=400');
                }
            };
            
            function filterByCategory(categoryId) {
                let jobs = DataStore.getJobs();
                
                // Filter: Only show approved jobs that are not expired
                const today = new Date().toISOString().split('T')[0];
                jobs = jobs.filter(job => 
                    job.status === 'approved' && 
                    job.deadline >= today &&
                    job.categoryId == categoryId
                );
                
                loadJobListings(jobs);
                $.mobile.changePage('#job-board');
            }
            
            function filterByLocation(locationId) {
                let jobs = DataStore.getJobs();
                
                // Filter: Only show approved jobs that are not expired
                const today = new Date().toISOString().split('T')[0];
                jobs = jobs.filter(job => 
                    job.status === 'approved' && 
                    job.deadline >= today &&
                    job.locationId == locationId
                );
                
                loadJobListings(jobs);
                $.mobile.changePage('#job-board');
            }
            
            function handleAddCategory(e) {
                e.preventDefault();
                
                const name = $('#category-name').val();
                
                if (!name) {
                    alert('Please enter a category name.');
                    return;
                }
                
                DataStore.addCategory({ name });
                populateCategories();
                
                $('#category-name').val('');
                alert('Category added successfully!');
            }
            
            function handleAddLocation(e) {
                e.preventDefault();
                
                const name = $('#location-name').val();
                
                if (!name) {
                    alert('Please enter a location name.');
                    return;
                }
                
                DataStore.addLocation({ name });
                populateLocations();
                
                $('#location-name').val('');
                alert('Location added successfully!');
            }
            
            function loadUserManagement() {
                const users = DataStore.getUsers();
                const currentUser = DataStore.getCurrentUser();
                const userManagement = $('#user-management');
                
                userManagement.empty();
                
                if (users.length === 0) {
                    userManagement.append('<p>No users found.</p>');
                    return;
                }
                
                users.forEach(user => {
                    const isCurrentUser = currentUser && user.id === currentUser.id;
                    
                    userManagement.append(`
                        <div class="ui-grid-a">
                            <div class="ui-block-a">
                                <div>${user.name} ${user.isAdmin ? '(Admin)' : '(User)'}</div>
                                <div>${user.email} | ${user.organization}</div>
                            </div>
                            <div class="ui-block-b">
                                ${!isCurrentUser ? 
                                    `<div>
                                        <button class="ui-btn ui-mini ${user.isAdmin ? 'btn-secondary' : 'btn-primary'} toggle-admin" data-id="${user.id}">
                                            ${user.isAdmin ? 'Demote to User' : 'Promote to Admin'}
                                        </button>
                                        <button class="ui-btn ui-mini delete-user" data-id="${user.id}">Delete</button>
                                    </div>` : 
                                    '<span class="ui-btn ui-mini ui-state-disabled">Current User</span>'
                                }
                            </div>
                        </div>
                    `);
                });
            }
            
            function loadJobManagement() {
                const jobs = DataStore.getJobs();
                const pendingJobs = $('#pending-jobs');
                const approvedJobs = $('#approved-jobs');
                
                pendingJobs.find('.job-item').remove();
                approvedJobs.find('.job-item').remove();
                
                const pending = jobs.filter(job => job.status === 'pending');
                const approved = jobs.filter(job => job.status === 'approved');
                
                if (pending.length === 0) {
                    pendingJobs.append('<p>No pending jobs for approval.</p>');
                } else {
                    pending.forEach(job => {
                        const category = DataStore.getCategories().find(c => c.id === job.categoryId);
                        const location = DataStore.getLocations().find(l => l.id === job.locationId);
                        
                        pendingJobs.append(`
                            <div class="job-item ui-grid-a">
                                <div class="ui-block-a">
                                    <div>${job.title}</div>
                                    <div>${job.organization} | ${category ? category.name : 'N/A'} | ${location ? location.name : 'N/A'}</div>
                                </div>
                                <div class="ui-block-b">
                                    <button class="ui-btn ui-mini btn-success approve-job" data-id="${job.id}">Approve</button>
                                    <button class="ui-btn ui-mini btn-secondary reject-job" data-id="${job.id}">Reject</button>
                                </div>
                            </div>
                        `);
                    });
                }
                
                if (approved.length === 0) {
                    approvedJobs.append('<p>No approved jobs.</p>');
                } else {
                    approved.forEach(job => {
                        const category = DataStore.getCategories().find(c => c.id === job.categoryId);
                        const location = DataStore.getLocations().find(l => l.id === job.locationId);
                        
                        approvedJobs.append(`
                            <div class="job-item ui-grid-a">
                                <div class="ui-block-a">
                                    <div>${job.title}</div>
                                    <div>${job.organization} | ${category ? category.name : 'N/A'} | ${location ? location.name : 'N/A'}</div>
                                </div>
                                <div class="ui-block-b">
                                    <button class="ui-btn ui-mini delete-job-admin" data-id="${job.id}">Delete</button>
                                </div>
                            </div>
                        `);
                    });
                }
            }
            
            function loadUserJobs() {
                const currentUser = DataStore.getCurrentUser();
                if (!currentUser) return;
                
                const jobs = DataStore.getJobs().filter(job => job.userId === currentUser.id);
                const myJobs = $('#my-jobs');
                
                myJobs.empty();
                
                if (jobs.length === 0) {
                    myJobs.append('<p>You haven\'t posted any jobs yet.</p>');
                    return;
                }
                
                jobs.forEach(job => {
                    const category = DataStore.getCategories().find(c => c.id === job.categoryId);
                    const location = DataStore.getLocations().find(l => l.id === job.locationId);
                    const statusClass = `status-${job.status}`;
                    
                    myJobs.append(`
                        <div class="job-card">
                            <div class="job-title">${job.title} <span class="job-status ${statusClass}">${job.status}</span></div>
                            <div class="job-org">${job.organization}</div>
                            <div class="job-meta">${category ? category.name : 'N/A'} | ${location ? location.name : 'N/A'} | Posted: ${job.datePosted}</div>
                            <div class="job-meta">Deadline: ${job.deadline}</div>
                        </div>
                    `);
                });
            }
            
            function deleteUser(userId) {
                if (confirm('Are you sure you want to delete this user?')) {
                    DataStore.deleteUser(parseInt(userId));
                    loadUserManagement();
                    alert('User deleted successfully!');
                }
            }
            
            function deleteCategory(categoryId) {
                if (confirm('Are you sure you want to delete this category?')) {
                    DataStore.deleteCategory(parseInt(categoryId));
                    populateCategories();
                    alert('Category deleted successfully!');
                }
            }
            
            function deleteLocation(locationId) {
                if (confirm('Are you sure you want to delete this location?')) {
                    DataStore.deleteLocation(parseInt(locationId));
                    populateLocations();
                    alert('Location deleted successfully!');
                }
            }
            
            function deleteJob(jobId) {
                if (confirm('Are you sure you want to delete this job?')) {
                    DataStore.deleteJob(parseInt(jobId));
                    loadJobManagement();
                    alert('Job deleted successfully!');
                }
            }
            
            function updateJobStatus(jobId, status) {
                const jobs = DataStore.getJobs();
                const job = jobs.find(j => j.id == jobId);
                
                if (job) {
                    job.status = status;
                    job.isPublished = (status === 'approved');
                    DataStore.updateJob(job);
                    loadJobManagement();
                    alert(`Job ${status} successfully!`);
                }
            }
            
            function toggleAdminStatus(userId) {
                const users = DataStore.getUsers();
                const user = users.find(u => u.id === userId);
                
                if (user) {
                    user.isAdmin = !user.isAdmin;
                    DataStore.setUsers(users);
                    
                    // If the toggled user is currently logged in, update their session
                    const currentUser = DataStore.getCurrentUser();
                    if (currentUser && currentUser.id === userId) {
                        currentUser.isAdmin = user.isAdmin;
                        DataStore.setCurrentUser(currentUser);
                        checkAuthStatus();
                    }
                    
                    loadUserManagement();
                    alert(`User ${user.isAdmin ? 'promoted to admin' : 'demoted to regular user'} successfully!`);
                }
            }
        });
    </script>
</body>
</html>