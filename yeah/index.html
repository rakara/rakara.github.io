<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeah Network - Job Board</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- jQuery and jQuery Mobile -->
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .ui-header {
            background-color: var(--secondary-color) !important;
            color: white !important;
            border: none !important;
        }
        
        .ui-footer {
            background-color: var(--secondary-color) !important;
            color: white !important;
            border: none !important;
            padding: 0 !important;
        }
        
        .logo {
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color) !important;
            border-color: var(--secondary-color) !important;
        }
        
        .btn-success {
            background-color: #27ae60 !important;
            border-color: #27ae60 !important;
        }
        
        .job-card {
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            background-color: white;
            cursor: pointer;
        }
        
        .job-title {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }
        
        .job-org {
            color: var(--primary-color);
            font-size: 0.9em;
        }
        
        .job-meta {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .admin-panel {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .admin-section {
            margin-bottom: 20px;
        }
        
        .admin-section h3 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .rich-text-editor {
            min-height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
        }
        
        .action-buttons {
            margin-top: 10px;
        }
        
        .action-buttons button {
            margin-right: 5px;
        }
        
        .search-form {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .browse-section {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .category-list, .location-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .category-item, .location-item {
            background-color: var(--light-color);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .category-item:hover, .location-item:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .job-detail {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .job-detail h2 {
            color: var(--secondary-color);
            margin-top: 0;
        }
        
        .job-detail-meta {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .job-detail-section {
            margin-bottom: 20px;
        }
        
        .job-detail-section h3 {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .share-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .share-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 0.9em;
        }
        
        .share-facebook {
            background-color: #3b5998;
        }
        
        .share-twitter {
            background-color: #1da1f2;
        }
        
        .share-linkedin {
            background-color: #0077b5;
        }
        
        .share-whatsapp {
            background-color: #25d366;
        }
        
        .apply-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #27ae60;
            color: white;
            text-align: center;
            border-radius: 5px;
            font-weight: bold;
            margin: 20px 0;
            text-decoration: none;
        }
        
        .offline-page {
            text-align: center;
            padding: 40px 20px;
        }
        
        .offline-icon {
            font-size: 64px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        /* Fixed Navigation */
        .fixed-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--secondary-color);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #95a5a6;
            text-decoration: none;
            font-size: 0.8em;
            flex: 1;
        }
        
        .nav-item i {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .nav-item.active {
            color: white;
        }
        
        .ui-content {
            padding-bottom: 70px !important;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .ui-grid-a .ui-block-a,
            .ui-grid-a .ui-block-b {
                width: 50%;
            }
        }
    </style>
</head>
<body>
    <!-- Home Page -->
    <div data-role="page" id="home">
        <div data-role="header" data-position="fixed">
            <h1><a href="#home" class="logo">Yeah Network</a></h1>
            <a href="#login" class="ui-btn-right" id="login-btn">Login</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="search-form">
                <h3>Find Your Dream Job</h3>
                <form id="search-form">
                    <div class="form-group">
                        <label for="search-title">Job Title</label>
                        <input type="text" id="search-title" class="form-control" placeholder="Enter job title">
                    </div>
                    <div class="form-group">
                        <label for="search-category">Category</label>
                        <select id="search-category" class="form-control">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="search-location">Location</label>
                        <select id="search-location" class="form-control">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Search Jobs</button>
                </form>
            </div>
            
            <div class="browse-section">
                <h3>Browse by Category</h3>
                <div class="category-list" id="category-list">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="browse-section">
                <h3>Browse by Location</h3>
                <div class="location-list" id="location-list">
                    <!-- Locations will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="job-listings">
                <h3>Latest Job Postings</h3>
                <!-- Job listings will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Login Page -->
    <div data-role="page" id="login">
        <div data-role="header">
            <h1>Login</h1>
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>Sign In</h3>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Login</button>
                </form>
                <p>Don't have an account? <a href="#signup" data-transition="slide">Sign up here</a></p>
            </div>
        </div>
    </div>
    
    <!-- Signup Page -->
    <div data-role="page" id="signup">
        <div data-role="header">
            <h1>Sign Up</h1>
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>Create Account</h3>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-organization">Organization</label>
                        <input type="text" id="signup-organization" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Create Account</button>
                </form>
                <p>Already have an account? <a href="#login" data-transition="slide">Login here</a></p>
            </div>
        </div>
    </div>
    
    <!-- Job Board Page -->
    <div data-role="page" id="job-board">
        <div data-role="header">
            <h1>Job Board</h1>
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div id="job-board-listings">
                <!-- Job listings will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Job Detail Page -->
    <div data-role="page" id="job-detail">
        <div data-role="header">
            <h1>Job Details</h1>
            <a href="#job-board" data-icon="back" data-iconpos="notext">Back</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div id="job-detail-content">
                <!-- Job details will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Post Job Page -->
    <div data-role="page" id="post-job">
        <div data-role="header">
            <h1>Post a Job</h1>
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <form id="job-form">
                    <div class="form-group">
                        <label for="job-title">Job Title</label>
                        <input type="text" id="job-title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-organization">Organization</label>
                        <input type="text" id="job-organization" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-category">Category</label>
                        <select id="job-category" class="form-control" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-location">Location</label>
                        <select id="job-location" class="form-control" required>
                            <option value="">Select Location</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-description">Job Description</label>
                        <div class="rich-text-editor" id="job-description" contenteditable="true"></div>
                    </div>
                    <div class="form-group">
                        <label for="job-requirements">Job Requirements</label>
                        <div class="rich-text-editor" id="job-requirements" contenteditable="true"></div>
                    </div>
                    <div class="form-group">
                        <label for="job-apply-link">Application Link</label>
                        <input type="url" id="job-apply-link" class="form-control" placeholder="https://..." required>
                    </div>
                    <div class="form-group">
                        <label for="job-deadline">Submission Deadline</label>
                        <input type="date" id="job-deadline" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Submit Job</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Profile Page -->
    <div data-role="page" id="profile">
        <div data-role="header">
            <h1>Profile</h1>
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>Account Information</h3>
                <form id="profile-form">
                    <div class="form-group">
                        <label for="profile-name">Full Name</label>
                        <input type="text" id="profile-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-email">Email</label>
                        <input type="email" id="profile-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-organization">Organization</label>
                        <input type="text" id="profile-organization" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-password">New Password (leave blank to keep current)</label>
                        <input type="password" id="profile-password" class="form-control">
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Update Profile</button>
                </form>
                <div class="action-buttons">
                    <button id="logout-btn" class="ui-btn btn-secondary">Logout</button>
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>My Job Postings</h3>
                <div id="my-jobs">
                    <!-- User's job postings will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div data-role="page" id="admin">
        <div data-role="header">
            <h1>Admin Dashboard</h1>
            <a href="#home" data-icon="home" data-iconpos="notext">Home</a>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="admin-panel">
                <h3>User Management</h3>
                <div id="user-management">
                    <!-- User list will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>Category Management</h3>
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-name">Category Name</label>
                        <input type="text" id="category-name" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Add Category</button>
                </form>
                <div id="category-list-admin">
                    <!-- Category list will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>Location Management</h3>
                <form id="location-form">
                    <div class="form-group">
                        <label for="location-name">Location Name</label>
                        <input type="text" id="location-name" class="form-control" required>
                    </div>
                    <button type="submit" class="ui-btn btn-primary">Add Location</button>
                </form>
                <div id="location-list-admin">
                    <!-- Location list will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="admin-panel">
                <h3>Job Listing Management</h3>
                <div id="job-management">
                    <!-- Job list will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Offline Page -->
    <div data-role="page" id="offline">
        <div data-role="header">
            <h1>Yeah Network</h1>
        </div>
        
        <div data-role="main" class="ui-content">
            <div class="offline-page">
                <div class="offline-icon">
                    <i class="fas fa-wifi"></i>
                </div>
                <h2>You're Offline</h2>
                <p>Please check your internet connection and try again to view the latest job postings.</p>
                <p>Some features may be limited while offline.</p>
                <button id="retry-connection" class="ui-btn btn-primary">Retry Connection</button>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Navigation -->
    <div class="fixed-nav">
        <a href="#home" class="nav-item active" id="nav-home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#job-board" class="nav-item" id="nav-jobs">
            <i class="fas fa-briefcase"></i>
            <span>Jobs</span>
        </a>
        <a href="#post-job" class="nav-item hidden" id="nav-post">
            <i class="fas fa-plus"></i>
            <span>Post Job</span>
        </a>
        <a href="#profile" class="nav-item hidden" id="nav-profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <a href="#admin" class="nav-item hidden" id="nav-admin">
            <i class="fas fa-cog"></i>
            <span>Admin</span>
        </a>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
        
        // Online/Offline detection
        window.addEventListener('online', function() {
            // Hide offline page if it's currently active
            if ($.mobile.activePage.attr('id') === 'offline') {
                $.mobile.changePage('#home');
            }
        });
        
        window.addEventListener('offline', function() {
            $.mobile.changePage('#offline');
        });
    </script>

    <!-- App Logic -->
    <script>
        // External JSON file URLs
        const DATA_URLS = {
            users: './data/users.json',
            jobs: './data/jobs.json',
            categories: './data/categories.json',
            locations: './data/locations.json'
        };

        // App data storage with external JSON support
        const DataStore = {
            // Initialize data by loading from external JSON files
            init: function() {
                return this.loadAllData();
            },
            
            // Load all data from external JSON files
            loadAllData: function() {
                return Promise.all([
                    this.loadData('users'),
                    this.loadData('jobs'),
                    this.loadData('categories'),
                    this.loadData('locations')
                ]);
            },
            
            // Load data from external JSON file with fallback to localStorage
            loadData: function(type) {
                return fetch(DATA_URLS[type])
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(data => {
                        // Store in localStorage as backup
                        localStorage.setItem(type, JSON.stringify(data));
                        return data;
                    })
                    .catch(error => {
                        console.warn(`Failed to load ${type} from server, using local data:`, error);
                        // Fallback to localStorage if available
                        const localData = localStorage.getItem(type);
                        return localData ? JSON.parse(localData) : this.getDefaultData(type);
                    });
            },
            
            // Get default data if nothing is available
            getDefaultData: function(type) {
                const defaults = {
                    users: [
                        {
                            id: 1,
                            name: 'Admin User',
                            email: 'admin@yeahnetwork.com',
                            password: 'admin123',
                            organization: 'Yeah Network',
                            isAdmin: true
                        }
                    ],
                    jobs: [],
                    categories: [
                        { id: 1, name: 'IT' },
                        { id: 2, name: 'Marketing' },
                        { id: 3, name: 'Finance' },
                        { id: 4, name: 'HR' },
                        { id: 5, name: 'Sales' }
                    ],
                    locations: [
                        { id: 1, name: 'New York' },
                        { id: 2, name: 'Remote' },
                        { id: 3, name: 'London' },
                        { id: 4, name: 'San Francisco' },
                        { id: 5, name: 'Tokyo' }
                    ]
                };
                
                localStorage.setItem(type, JSON.stringify(defaults[type]));
                return defaults[type];
            },
            
            // Get data (from localStorage as we've already loaded it)
            getUsers: function() {
                const data = localStorage.getItem('users');
                return data ? JSON.parse(data) : [];
            },
            
            getJobs: function() {
                const data = localStorage.getItem('jobs');
                return data ? JSON.parse(data) : [];
            },
            
            getCategories: function() {
                const data = localStorage.getItem('categories');
                return data ? JSON.parse(data) : [];
            },
            
            getLocations: function() {
                const data = localStorage.getItem('locations');
                return data ? JSON.parse(data) : [];
            },
            
            getCurrentUser: function() {
                return JSON.parse(localStorage.getItem('currentUser') || 'null');
            },
            
            // Save data to external server (simulated - in a real app, you'd use a backend API)
            saveData: function(type, data) {
                // In a real implementation, you would send a POST/PUT request to your server
                // For this demo, we'll just update localStorage and simulate server sync
                localStorage.setItem(type, JSON.stringify(data));
                
                // Simulate server sync (in a real app, replace with actual API call)
                console.log(`Simulating save of ${type} to server`);
                return Promise.resolve(true);
            },
            
            // Set current user
            setCurrentUser: function(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            },
            
            // Add data with server sync simulation
            addUser: function(user) {
                const users = this.getUsers();
                user.id = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                users.push(user);
                return this.saveData('users', users).then(() => user);
            },
            
            addJob: function(job) {
                const jobs = this.getJobs();
                job.id = jobs.length > 0 ? Math.max(...jobs.map(j => j.id)) + 1 : 1;
                job.datePosted = new Date().toISOString().split('T')[0];
                job.isPublished = true;
                jobs.push(job);
                return this.saveData('jobs', jobs).then(() => job);
            },
            
            addCategory: function(category) {
                const categories = this.getCategories();
                category.id = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
                categories.push(category);
                return this.saveData('categories', categories).then(() => category);
            },
            
            addLocation: function(location) {
                const locations = this.getLocations();
                location.id = locations.length > 0 ? Math.max(...locations.map(l => l.id)) + 1 : 1;
                locations.push(location);
                return this.saveData('locations', locations).then(() => location);
            },
            
            // Update data with server sync simulation
            updateUser: function(user) {
                const users = this.getUsers();
                const index = users.findIndex(u => u.id === user.id);
                if (index !== -1) {
                    users[index] = user;
                    return this.saveData('users', users).then(() => true);
                }
                return Promise.resolve(false);
            },
            
            updateJob: function(job) {
                const jobs = this.getJobs();
                const index = jobs.findIndex(j => j.id === job.id);
                if (index !== -1) {
                    jobs[index] = job;
                    return this.saveData('jobs', jobs).then(() => true);
                }
                return Promise.resolve(false);
            },
            
            // Delete data with server sync simulation
            deleteUser: function(id) {
                const users = this.getUsers().filter(u => u.id !== id);
                return this.saveData('users', users).then(() => users);
            },
            
            deleteJob: function(id) {
                const jobs = this.getJobs().filter(j => j.id !== id);
                return this.saveData('jobs', jobs).then(() => jobs);
            },
            
            deleteCategory: function(id) {
                const categories = this.getCategories().filter(c => c.id !== id);
                return this.saveData('categories', categories).then(() => categories);
            },
            
            deleteLocation: function(id) {
                const locations = this.getLocations().filter(l => l.id !== id);
                return this.saveData('locations', locations).then(() => locations);
            }
        };

        // App logic
        $(document).ready(function() {
            // Initialize data and then setup the app
            DataStore.init().then(() => {
                // Check if user is logged in
                checkAuthStatus();
                
                // Populate dropdowns and lists
                populateCategories();
                populateLocations();
                loadJobListings();
                
                // Setup navigation
                setupNavigation();
            });
            
            // Event handlers
            $('#login-form').on('submit', handleLogin);
            $('#signup-form').on('submit', handleSignup);
            $('#search-form').on('submit', handleSearch);
            $('#job-form').on('submit', handleJobPost);
            $('#profile-form').on('submit', handleProfileUpdate);
            $('#logout-btn').on('click', handleLogout);
            $('#category-form').on('submit', handleAddCategory);
            $('#location-form').on('submit', handleAddLocation);
            $('#retry-connection').on('click', function() {
                if (navigator.onLine) {
                    // Reload data from server
                    DataStore.loadAllData().then(() => {
                        populateCategories();
                        populateLocations();
                        loadJobListings();
                        $.mobile.changePage('#home');
                    });
                }
            });
            
            // Navigation events
            $('body').on('click', '.job-card', function() {
                const jobId = $(this).data('id');
                showJobDetail(jobId);
            });
            
            $('body').on('click', '.category-item', function() {
                const categoryId = $(this).data('id');
                filterByCategory(categoryId);
            });
            
            $('body').on('click', '.location-item', function() {
                const locationId = $(this).data('id');
                filterByLocation(locationId);
            });
            
            // Admin event handlers
            $('body').on('click', '.delete-user', function() {
                const userId = $(this).data('id');
                deleteUser(userId);
            });
            
            $('body').on('click', '.delete-category', function() {
                const categoryId = $(this).data('id');
                deleteCategory(categoryId);
            });
            
            $('body').on('click', '.delete-location', function() {
                const locationId = $(this).data('id');
                deleteLocation(locationId);
            });
            
            $('body').on('click', '.delete-job-admin', function() {
                const jobId = $(this).data('id');
                deleteJob(jobId);
            });
            
            $('body').on('click', '.toggle-job-status', function() {
                const jobId = $(this).data('id');
                toggleJobStatus(jobId);
            });
            
            $('body').on('click', '.toggle-admin', function() {
                const userId = $(this).data('id');
                toggleAdminStatus(userId);
            });
            
            // Page events for navigation highlighting
            $(document).on('pagebeforeshow', function(event, ui) {
                const pageId = ui.toPage.attr('id');
                updateNavigation(pageId);
            });
            
            // Functions
            function setupNavigation() {
                // Initial navigation setup
                updateNavigation('home');
            }
            
            function updateNavigation(activePage) {
                // Reset all nav items
                $('.nav-item').removeClass('active');
                
                // Set active based on current page
                switch(activePage) {
                    case 'home':
                        $('#nav-home').addClass('active');
                        break;
                    case 'job-board':
                        $('#nav-jobs').addClass('active');
                        break;
                    case 'post-job':
                        $('#nav-post').addClass('active');
                        break;
                    case 'profile':
                        $('#nav-profile').addClass('active');
                        break;
                    case 'admin':
                        $('#nav-admin').addClass('active');
                        break;
                }
            }
            
            function checkAuthStatus() {
                const currentUser = DataStore.getCurrentUser();
                if (currentUser) {
                    $('#login-btn').text('Logout').attr('href', '#').off('click').on('click', handleLogout);
                    $('#post-job-btn, #profile-btn').removeClass('hidden');
                    $('#nav-post, #nav-profile').removeClass('hidden');
                    
                    // Only show admin button if user is admin
                    if (currentUser.isAdmin) {
                        $('#admin-btn').removeClass('hidden');
                        $('#nav-admin').removeClass('hidden');
                    } else {
                        $('#admin-btn').addClass('hidden');
                        $('#nav-admin').addClass('hidden');
                    }
                } else {
                    $('#login-btn').text('Login').attr('href', '#login');
                    $('#post-job-btn, #profile-btn, #admin-btn').addClass('hidden');
                    $('#nav-post, #nav-profile, #nav-admin').addClass('hidden');
                }
            }
            
            // ... (rest of the functions remain similar but now use Promises for async operations)
            // Note: I've truncated some repetitive functions for brevity
            
            function showJobDetail(jobId) {
                const job = DataStore.getJobs().find(j => j.id == jobId);
                if (!job) {
                    alert('Job not found.');
                    return;
                }
                
                const category = DataStore.getCategories().find(c => c.id === job.categoryId);
                const location = DataStore.getLocations().find(l => l.id === job.locationId);
                
                const jobDetailContent = `
                    <div class="job-detail">
                        <h2>${job.title}</h2>
                        <div class="job-detail-meta">
                            ${job.organization} | ${category ? category.name : 'N/A'} | ${location ? location.name : 'N/A'}
                        </div>
                        <div class="job-detail-meta">
                            Posted: ${job.datePosted} | Deadline: ${job.deadline}
                        </div>
                        
                        <div class="share-buttons">
                            <div class="share-btn share-facebook" onclick="shareJob('facebook', ${job.id})">
                                <i class="fab fa-facebook-f"></i> Facebook
                            </div>
                            <div class="share-btn share-twitter" onclick="shareJob('twitter', ${job.id})">
                                <i class="fab fa-twitter"></i> Twitter
                            </div>
                            <div class="share-btn share-linkedin" onclick="shareJob('linkedin', ${job.id})">
                                <i class="fab fa-linkedin-in"></i> LinkedIn
                            </div>
                            <div class="share-btn share-whatsapp" onclick="shareJob('whatsapp', ${job.id})">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </div>
                        </div>
                        
                        ${job.applyLink ? `<a href="${job.applyLink}" target="_blank" class="apply-btn">Apply Now</a>` : ''}
                        
                        <div class="job-detail-section">
                            <h3>Job Description</h3>
                            <div>${job.description}</div>
                        </div>
                        
                        <div class="job-detail-section">
                            <h3>Job Requirements</h3>
                            <div>${job.requirements}</div>
                        </div>
                    </div>
                `;
                
                $('#job-detail-content').html(jobDetailContent);
                $.mobile.changePage('#job-detail');
            }
            
            // Share job function
            window.shareJob = function(platform, jobId) {
                const job = DataStore.getJobs().find(j => j.id == jobId);
                if (!job) return;
                
                const jobTitle = encodeURIComponent(job.title);
                const jobOrg = encodeURIComponent(job.organization);
                const shareUrl = encodeURIComponent(window.location.href.split('#')[0] + `#job-detail&job=${jobId}`);
                const text = encodeURIComponent(`Check out this job: ${job.title} at ${job.organization}`);
                
                let shareLink = '';
                
                switch(platform) {
                    case 'facebook':
                        shareLink = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
                        break;
                    case 'twitter':
                        shareLink = `https://twitter.com/intent/tweet?text=${text}&url=${shareUrl}`;
                        break;
                    case 'linkedin':
                        shareLink = `https://www.linkedin.com/sharing/share-offsite/?url=${shareUrl}`;
                        break;
                    case 'whatsapp':
                        shareLink = `https://api.whatsapp.com/send?text=${text} ${shareUrl}`;
                        break;
                }
                
                if (shareLink) {
                    window.open(shareLink, '_blank', 'width=600,height=400');
                }
            };
            
            // ... (other functions would be updated similarly to use Promises)
            
        });
    </script>
</body>
</html>