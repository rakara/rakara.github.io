<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0a">
    <title>Confirm Ride - TickRide</title>
    <link rel="icon" href="/ride/icons/favicon.png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * { margin:0; padding:0; box-sizing:border-box; }
        
        :root {
            --bg0:#0a0a0a; --bg1:#141414; --bg2:#1e1e1e;
            --text1:#ffffff; --text2:#a0a0a0;
            --accent:#00ff88; --accent2:#00ccff;
            --danger:#ff3366;
        }
        
        body {
            font-family:'Outfit',sans-serif;
            background:var(--bg0); color:var(--text1);
            max-width:480px; margin:0 auto; min-height:100vh;
            display:flex; flex-direction:column;
        }
        
        .header {
            padding:16px 20px;
            background:rgba(10,10,10,.95);
            backdrop-filter:blur(20px);
            border-bottom:1px solid rgba(255,255,255,.05);
            display:flex; align-items:center; gap:16px;
            position:sticky; top:0; z-index:100;
        }
        
        .back-btn {
            width:36px; height:36px; border-radius:50%;
            background:var(--bg1); border:1px solid rgba(255,255,255,.1);
            display:flex; align-items:center; justify-content:center;
            cursor:pointer; transition:all .2s;
            font-size:18px; text-decoration:none; color:var(--text1);
        }
        .back-btn:hover { border-color:var(--accent); }
        
        .header-title { flex:1; font-size:18px; font-weight:700; }
        
        .map-section {
            height:280px; position:relative;
            background:var(--bg1);
        }
        
        #map { width:100%; height:100%; }
        
        .map-overlay {
            position:absolute; bottom:12px; left:12px; right:12px;
            background:rgba(10,10,10,.92); backdrop-filter:blur(12px);
            border-radius:14px; padding:14px 16px;
            border:1px solid rgba(0,255,136,.2);
        }
        
        .route-row {
            display:flex; align-items:flex-start; gap:12px;
            margin-bottom:10px;
        }
        .route-row:last-child { margin-bottom:0; }
        
        .route-dot {
            width:10px; height:10px; border-radius:50%;
            margin-top:4px; flex-shrink:0;
        }
        .route-dot.pickup { background:var(--accent); box-shadow:0 0 8px rgba(0,255,136,.5); }
        .route-dot.dropoff { background:var(--accent2); box-shadow:0 0 8px rgba(0,204,255,.5); }
        
        .route-text { font-size:14px; font-weight:600; line-height:1.4; }
        .route-sub { font-size:12px; color:var(--text2); margin-top:2px; }
        
        main { flex:1; padding:20px; }
        
        .section-title {
            font-size:13px; font-weight:600; color:var(--text2);
            text-transform:uppercase; letter-spacing:.6px;
            margin-bottom:12px;
        }
        
        .ride-card {
            background:linear-gradient(135deg, rgba(0,255,136,.08), rgba(0,204,255,.08));
            border:1px solid rgba(0,255,136,.2);
            border-radius:20px; padding:20px;
            margin-bottom:20px;
        }
        
        .ride-header {
            display:flex; justify-content:space-between; align-items:center;
            margin-bottom:16px;
        }
        
        .ride-type {
            display:flex; align-items:center; gap:12px;
        }
        .ride-icon { font-size:32px; }
        .ride-name { font-size:20px; font-weight:700; }
        .ride-details { font-size:13px; color:var(--text2); margin-top:2px; }
        
        .ride-price {
            font-family:'JetBrains Mono',monospace;
            font-size:28px; font-weight:800;
            background:linear-gradient(135deg,var(--accent),var(--accent2));
            -webkit-background-clip:text; background-clip:text;
            -webkit-text-fill-color:transparent;
        }
        
        .ride-stats {
            display:grid; grid-template-columns:repeat(3,1fr);
            gap:12px; padding-top:16px;
            border-top:1px solid rgba(255,255,255,.08);
        }
        
        .stat { text-align:center; }
        .stat-value {
            font-family:'JetBrains Mono',monospace;
            font-size:16px; font-weight:700; color:var(--accent);
        }
        .stat-label { font-size:11px; color:var(--text2); margin-top:4px; }
        
        .payment-card {
            background:var(--bg1);
            border:1px solid rgba(255,255,255,.05);
            border-radius:16px; padding:16px;
            display:flex; align-items:center; gap:14px;
            cursor:pointer; transition:all .2s;
            margin-bottom:20px;
        }
        
        .payment-card:hover {
            background:var(--bg2);
            border-color:rgba(0,255,136,.2);
        }
        
        .payment-icon {
            width:44px; height:44px; border-radius:12px;
            background:var(--bg2);
            display:flex; align-items:center; justify-content:center;
            font-size:20px; flex-shrink:0;
        }
        
        .payment-info { flex:1; }
        .payment-name { font-size:15px; font-weight:600; }
        .payment-desc { font-size:13px; color:var(--text2); margin-top:2px; }
        
        .change-btn {
            font-size:13px; color:var(--accent);
            font-weight:600; text-decoration:none;
        }
        
        .promo-input-wrap {
            position:relative; margin-bottom:20px;
        }
        
        .promo-input {
            width:100%; padding:14px 16px;
            background:var(--bg1);
            border:1px solid rgba(255,255,255,.05);
            border-radius:14px; outline:none;
            color:var(--text1); font-size:15px;
            font-family:'Outfit',sans-serif;
        }
        
        .promo-input::placeholder { color:var(--text2); }
        .promo-input:focus { border-color:var(--accent); }
        
        .apply-btn {
            position:absolute; right:6px; top:50%;
            transform:translateY(-50%);
            padding:8px 16px; background:var(--accent);
            border:none; border-radius:10px;
            color:#000; font-weight:700; font-size:13px;
            cursor:pointer; transition:all .2s;
        }
        .apply-btn:hover { opacity:.85; }
        
        .cta-button {
            width:100%; padding:18px;
            background:linear-gradient(135deg,var(--accent),var(--accent2));
            border:none; border-radius:16px;
            color:#000; font-size:18px; font-weight:800;
            cursor:pointer; transition:all .3s;
            box-shadow:0 8px 24px rgba(0,255,136,.3);
            margin-bottom:12px;
        }
        
        .cta-button:hover {
            transform:translateY(-2px);
            box-shadow:0 12px 32px rgba(0,255,136,.4);
        }
        
        .cancel-btn {
            width:100%; padding:16px;
            background:transparent;
            border:1px solid rgba(255,255,255,.1);
            border-radius:14px;
            color:var(--text2); font-size:15px; font-weight:600;
            cursor:pointer; transition:all .2s;
        }
        .cancel-btn:hover { border-color:var(--danger); color:var(--danger); }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="back-btn">‚Üê</a>
        <div class="header-title">Confirm Ride</div>
    </div>
    
    <div class="map-section">
        <div id="map"></div>
        <div class="map-overlay">
            <div class="route-row">
                <div class="route-dot pickup"></div>
                <div>
                    <div class="route-text" id="pickup-name">Westlands, Nairobi</div>
                    <div class="route-sub">Pickup location</div>
                </div>
            </div>
            <div class="route-row">
                <div class="route-dot dropoff"></div>
                <div>
                    <div class="route-text" id="dropoff-name">CBD, Nairobi</div>
                    <div class="route-sub">Destination</div>
                </div>
            </div>
        </div>
    </div>
    
    <main>
        <div class="section-title">Your Ride</div>
        <div class="ride-card">
            <div class="ride-header">
                <div class="ride-type">
                    <div class="ride-icon">üöó</div>
                    <div>
                        <div class="ride-name" id="ride-type">TickX</div>
                        <div class="ride-details" id="ride-seats">4 seats ¬∑ Economy</div>
                    </div>
                </div>
                <div class="ride-price" id="ride-price">KSh 450</div>
            </div>
            <div class="ride-stats">
                <div class="stat">
                    <div class="stat-value" id="stat-distance">8.4 km</div>
                    <div class="stat-label">Distance</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="stat-time">18 min</div>
                    <div class="stat-label">Est. Time</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="stat-eta">2 min</div>
                    <div class="stat-label">Driver ETA</div>
                </div>
            </div>
        </div>
        
        <div class="section-title">Payment Method</div>
        <div class="payment-card">
            <div class="payment-icon">üì±</div>
            <div class="payment-info">
                <div class="payment-name">M-PESA</div>
                <div class="payment-desc">+254 712 *** 678</div>
            </div>
            <a href="payment.html" class="change-btn">Change</a>
        </div>
        
        <div class="section-title">Promo Code</div>
        <div class="promo-input-wrap">
            <input type="text" class="promo-input" placeholder="Enter promo code" id="promo-input">
            <button class="apply-btn" id="apply-promo">Apply</button>
        </div>
        
        <button class="cta-button" id="confirm-btn">
            Confirm & Request TickX
        </button>
        
        <button class="cancel-btn" onclick="history.back()">
            Cancel Request
        </button>
    </main>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Get params from URL or localStorage
        const urlParams = new URLSearchParams(window.location.search);
        const pickup    = JSON.parse(localStorage.getItem('tripPickup') || '{"lat":-1.2897,"lng":36.7826,"name":"Westlands, Nairobi"}');
        const dest      = JSON.parse(localStorage.getItem('tripDest') || '{"lat":-1.2921,"lng":36.8219,"name":"CBD, Nairobi"}');
        const tier      = localStorage.getItem('tripTier') || 'TickX';
        const fare      = localStorage.getItem('tripFare') || 'KSh 450';
        const distance  = localStorage.getItem('tripDistance') || '8.4 km';
        const time      = localStorage.getItem('tripTime') || '18 min';
        
        // Populate UI
        document.getElementById('pickup-name').textContent  = pickup.name;
        document.getElementById('dropoff-name').textContent = dest.name;
        document.getElementById('ride-type').textContent    = tier;
        document.getElementById('ride-price').textContent   = fare;
        document.getElementById('stat-distance').textContent = distance;
        document.getElementById('stat-time').textContent    = time;
        document.querySelector('.cta-button').textContent   = `Confirm & Request ${tier}`;
        
        // Initialize map
        const map = L.map('map', { zoomControl:false, scrollWheelZoom:false });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'¬© OSM' }).addTo(map);
        
        // Markers
        const pickupIcon = L.divIcon({
            html: '<div style="width:32px;height:32px;background:linear-gradient(135deg,#00ff88,#00ccff);border-radius:50%;border:3px solid #0a0a0a;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:0 3px 10px rgba(0,255,136,.5)">üìç</div>',
            iconSize:[32,32], iconAnchor:[16,16]
        });
        const destIcon = L.divIcon({
            html: '<div style="width:32px;height:32px;background:linear-gradient(135deg,#00ccff,#0066ff);border-radius:50%;border:3px solid #0a0a0a;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:0 3px 10px rgba(0,204,255,.5)">üéØ</div>',
            iconSize:[32,32], iconAnchor:[16,16]
        });
        
        L.marker([pickup.lat, pickup.lng], {icon:pickupIcon}).addTo(map);
        L.marker([dest.lat, dest.lng], {icon:destIcon}).addTo(map);
        
        // Route line
        const midLat = (pickup.lat + dest.lat)/2 + (dest.lng - pickup.lng)*0.06;
        const midLng = (pickup.lng + dest.lng)/2 - (dest.lat - pickup.lat)*0.06;
        const pts = [];
        for(let i=0; i<=20; i++) {
            const t = i/20;
            pts.push([
                (1-t)**2*pickup.lat + 2*(1-t)*t*midLat + t**2*dest.lat,
                (1-t)**2*pickup.lng + 2*(1-t)*t*midLng + t**2*dest.lng
            ]);
        }
        const route = L.polyline(pts, { color:'#00ff88', weight:3, dashArray:'6 4' }).addTo(map);
        map.fitBounds(route.getBounds(), { padding:[40,40] });
        
        // Promo code
        document.getElementById('apply-promo').addEventListener('click', () => {
            const code = document.getElementById('promo-input').value.toUpperCase();
            if (code === 'TICK25') {
                alert('‚úì Promo code applied! 25% discount on this ride.');
                document.getElementById('promo-input').style.borderColor = 'var(--accent)';
            } else if (code) {
                alert('‚ùå Invalid promo code');
            }
        });
        
        // Confirm button
        document.getElementById('confirm-btn').addEventListener('click', () => {
            // Save trip to localStorage for active trip screen
            localStorage.setItem('activeTrip', JSON.stringify({
                pickup, dest, tier, fare, distance, time,
                requestedAt: new Date().toISOString()
            }));
            window.location.href = 'trip-active.html';
        });
    </script>
</body>
</html>
